<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="傅杭波, Uhfun傅杭波, Uhfun, UhfunBlog, Hbson傅杭波, Hb, Hbson, 博客, 个人网站, 互联网, 后端, Web, Java, Spring, 翻唱, 唱歌">
  <meta name="description" content='代码与生活、热爱唱歌的boy | 傅杭波的个人博客'>
  <meta name="robots" content="all">

  <meta property="og:type" content="post" />
  
  
  <meta property="og:title" content="Spring 注解 | UhfunBlog" />

  <meta property="og:image" content='http://uhfun.cn/assets/img/avatar.png' />

  <meta property="og:type" content="article">
  <meta property="og:description" content="这里罗列一些Spring的注解，不断巩固

">
  
  <meta property="article:published_time" content='2018-08-08T11:10:00Z'>
  
  <meta property="article:author" content="傅杭波">
  
  

    
  <meta property="og:image" content="" >
  <meta property="og:url" content="http://uhfun.cn/tech/2018/08/08/Spring%E6%B3%A8%E8%A7%A3.html">
  
  <meta property="article:tag" content="Spring">
  
  <meta property="article:tag" content="注解">
  
  <meta property="article:tag" content="annotation">
  
  <meta property="og:site_name" content="傅杭波的博客UhfunBlog" />

  <meta name="baidu-site-verification" content= "9DYfdd4yEo" />
  <meta name="google-site-verification" content="uDSkqT9lEtkk2RsKYeldTKkmr4u_yI5aR3Y-tGgjcBo" />
  <title>Spring 注解 | UhfunBlog</title>

  <!-- Favicon -->
  <link rel="shortcut icon" href="/assets/img/favicon.ico">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">

  <link type="application/atom+xml" rel="alternate" href="http://uhfun.cn/feed.xml" title="UhfunBlog" />
  

  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/font-awesome/5.11.2/js/all.min.js"></script>
</head>
<body>
  <header class="navbar has-shadow is-spaced" role="banner">
  <div class="container">
    
    
    
    <div class="navbar-brand">
      <a class="navbar-item" href="/">
        <img src='/assets/img/logo.png' width="160">
      </a>
      <div role="button" class="navbar-burger burger" data-target="navbarExampleTransparentExample">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </div>
    </div>

    <div class="navbar-menu">
      <div class="navbar-end">
        <a class='navbar-item' href='/'>HOME</a>


                 
              
           
        
        

        
                 
              
           
        
        

        
        <a class="navbar-item" href="/README.html">
          README
        </a>
        
                 
              
           
        
        

        
                 
              
           
        
        

        
        <a class="navbar-item" href="/tag/">
          TAG
        </a>
        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
        <a class="navbar-item" href="/life/">
          LIFE
        </a>
        
                 
              
           
        
        

        
        <a class="navbar-item" href="/tech/">
          TECH
        </a>
        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
                 
              
           
        
        

        
        
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link">
              <!-- <img class="is-rounded" src="/img/avatar.png"> -->
              <img class="is-rounded" src='/assets/img/avatar.png'>
          </a>
          <div class="navbar-dropdown is-right">
            <a class="icon-dropdown navbar-item" href="/about.html">
              <i class="far fa-user" aria-hidden="true"></i> About
            </a>
            <a class="icon-dropdown navbar-item" href="https://github.com/uhfun">
              <i class="fab fa-github" aria-hidden="true"></i> Github
            </a>
            <hr class="navbar-divider">
            <a class="navbar-item" href="/README.html#utterances"> Report an issue
            </a>
          </div>
        </div>
      </div>
    </div>
    
  </div>
</header>
  <div class="section">
    <div class="container">
      <article class="page">
  <div class="content">
    <article class="post">
  
  <h1 class="title is-spaced">Spring 注解</h1>
  
  
  
  <div class="tags">
    <div class="container">
        
        <span class="icon is-small">
            <i class="fa fa-tags" aria-hidden="true"></i>
        </span>
        
        
        <a href="/tag/spring">Spring</a>
        
        <a href="/tag/%e6%b3%a8%e8%a7%a3">注解</a>
        
        <a href="/tag/annotation">annotation</a>
        
        
        <span class="spot">•</span>
        
        <span class='formated-date' data-time="2018/08/08 11:10:00">
            2018-08-08
        </span>
    </div>
</div>
  <div class='post-img'>
    
    


    
  </div>
  <div id="toc"></div>
  <div class='post-content'>
    
    <p>这里罗列一些Spring的注解，不断巩固</p>

<h2 id="spring-core-annotations">Spring Core Annotations</h2>
<h3 id="概述">概述</h3>
<p>我们可以使用 <strong><code class="language-plaintext highlighter-rouge">org.springframework.beans.factory.annotation</code></strong> 和<strong><code class="language-plaintext highlighter-rouge">org.springframework.context.annotation</code></strong> 包中的注释来利用Spring DI引擎的功能。</p>

<p>称之为spring核心注解（Spring core annotations）</p>
<h3 id="依赖注入相关注释">依赖注入相关注释</h3>
<h4 id="autowired">@Autowired</h4>
<p>我们可以使用@Autowired标记Spring将要解析和注入的依赖项。我们可以将这个注释与构造函数，setter或字段注入一起使用。</p>
<h5 id="构造方法注入">构造方法注入：</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
    <span class="nc">Engine</span> <span class="n">engine</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="nc">Car</span><span class="o">(</span><span class="nc">Engine</span> <span class="n">engine</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">engine</span> <span class="o">=</span> <span class="n">engine</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="setter方法注入">setter方法注入</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
    <span class="nc">Engine</span> <span class="n">engine</span><span class="o">;</span>
 
    <span class="nd">@Autowired</span>
    <span class="kt">void</span> <span class="nf">setEngine</span><span class="o">(</span><span class="nc">Engine</span> <span class="n">engine</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">engine</span> <span class="o">=</span> <span class="n">engine</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="属性注入">属性注入</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">Engine</span> <span class="n">engine</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>@Autowired有默认为required的布尔参数，默认值为true。当它没有找到合适的bean，如果为true，则抛出异常。</p>

<p>如果使用构造函数注入，则所有构造函数参数都是必需的。</p>

<p>从版本4.3开始，除非我们声明至少两个构造函数，否则我们不需要显式地使用@Autowired注释构造函数。</p>

<p><a href="https://www.baeldung.com/spring-autowire">@Autowired and constructor injection相关详细内容</a></p>
<h4 id="bean">@Bean</h4>
<p>@Bean标记了一个实例化Spring bean的工厂方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nc">Engine</span> <span class="nf">engine</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Engine</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<p>当需要返回类型的新实例时，Spring会调用这些方法。</p>

<p>生成的bean与工厂方法具有相同的名称。如果我们想以不同的方式命名，我们可以使用此注解的名称或值参数（参数值是参数名称的别名）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span><span class="o">(</span><span class="s">"engine"</span><span class="o">)</span>
<span class="nc">Engine</span> <span class="nf">getEngine</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Engine</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>
<blockquote>
  <p>注意，所有使用@Bean注释的方法都必须在@Configuration类中。</p>
</blockquote>

<h4 id="qualifier">@Qualifier</h4>
<p>使用@Autowired 不确定bean id 或 bean name时，可以使用Qualifier来显式指定。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">、、两个</span><span class="n">bean</span><span class="err">实现相同的接口</span>
<span class="kd">class</span> <span class="nc">Bike</span> <span class="kd">implements</span> <span class="nc">Vehicle</span> <span class="o">{}</span>
<span class="kd">class</span> <span class="nc">Car</span> <span class="kd">implements</span> <span class="nc">Vehicle</span> <span class="o">{}</span>
</code></pre></div></div>
<p>如果Spring需要注入一个Vehicle bean，它最终会有多个匹配的定义。在这种情况下，我们可以使用@Qualifier注释显式提供bean的名称。</p>

<h5 id="构造方法注入-1">构造方法注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="nc">Biker</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"bike"</span><span class="o">)</span> <span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">vehicle</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h5 id="setter方法注入-1">setter方法注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="kt">void</span> <span class="nf">setVehicle</span><span class="o">(</span><span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"bike"</span><span class="o">)</span> <span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">vehicle</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="setter方法注入2">setter方法注入2</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"bike"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">setVehicle</span><span class="o">(</span><span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">vehicle</span> <span class="o">=</span> <span class="n">vehicle</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="属性注入-1">属性注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"bike"</span><span class="o">)</span>
<span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">;</span>
</code></pre></div></div>
<p><a href="https://www.baeldung.com/spring-autowire">更多详细内容</a></p>
<h4 id="required">@Required</h4>
<p>@Required 注释应用于 bean 属性的 setter 方法，它表明受影响的 bean 属性在配置时必须放在 XML 配置文件中，否则容器就会抛出一个 BeanInitializationException 异常。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Required</span>
<span class="kt">void</span> <span class="nf">setColor</span><span class="o">(</span><span class="nc">String</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.baeldung.annotations.Bike"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"color"</span> <span class="na">value=</span><span class="s">"green"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div>
<h4 id="value">@Value</h4>
<p>我们可以使用@Value将属性值注入bean。它与构造方法注入，setter方法注入和属性注入兼容。</p>
<h5 id="构造方法注入-2">构造方法注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Engine</span><span class="o">(</span><span class="nd">@Value</span><span class="o">(</span><span class="s">"8"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">cylinderCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cylinderCount</span> <span class="o">=</span> <span class="n">cylinderCount</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<h5 id="setter方法注入-2">setter方法注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Autowired</span>
<span class="kt">void</span> <span class="nf">setCylinderCount</span><span class="o">(</span><span class="nd">@Value</span><span class="o">(</span><span class="s">"8"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">cylinderCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cylinderCount</span> <span class="o">=</span> <span class="n">cylinderCount</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="setter方法注入2-1">setter方法注入2</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Value</span><span class="o">(</span><span class="s">"8"</span><span class="o">)</span>
<span class="kt">void</span> <span class="nf">setCylinderCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">cylinderCount</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">cylinderCount</span> <span class="o">=</span> <span class="n">cylinderCount</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h5 id="属性注入-2">属性注入</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Value</span><span class="o">(</span><span class="s">"8"</span><span class="o">)</span>
<span class="kt">int</span> <span class="n">cylinderCount</span><span class="o">;</span>
</code></pre></div></div>

<p>我们可以在@Value中使用占位符字符串来连接外部源中定义的值，例如，在.properties或.yaml文件中</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">engine.fuelType</span><span class="p">=</span><span class="s">petrol</span>
</code></pre></div></div>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Value</span><span class="o">(</span><span class="s">"${engine.fuelType}"</span><span class="o">)</span>
<span class="nc">String</span> <span class="n">fuelType</span><span class="o">;</span>
</code></pre></div></div>
<p>即使使用SpEL，我们也可以使用@Value。有关<a href="https://www.baeldung.com/spring-value-annotation">@Value的文章</a>中可以找到更高级的示例</p>

<h4 id="dependson">@DependsOn</h4>
<p>我们可以使用这个注释使Spring在注释之前初始化其他bean。通常，此行为是自动的，基于bean之间的显式依赖关系。</p>

<p>只在当依赖关系是隐式时标注该注解，例如JDBC驱动程序加载或静态变量初始化</p>

<p>我们可以在依赖类上使用@DependsOn来指定依赖关系bean的名称。注释的value参数需要一个包含依赖项bean名称的数组：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@DependsOn</span><span class="o">(</span><span class="s">"engine"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Car</span> <span class="kd">implements</span> <span class="nc">Vehicle</span> <span class="o">{}</span>
</code></pre></div></div>

<p>或者，如果我们使用@Bean批注定义bean，则应使用@DependsOn注释工厂方法</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@DependsOn</span><span class="o">(</span><span class="s">"fuel"</span><span class="o">)</span>
<span class="nc">Engine</span> <span class="nf">engine</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Engine</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="lazy">@Lazy</h4>
<ul>
  <li>标记在bean工厂方法：延迟方法的调用</li>
  <li>标记在配置类上：所有的bean都会被延迟创建</li>
  <li>标记在组件类上（不包括配置类）：bean会被延迟初始化</li>
  <li>标记在构造方法，setter方法，属性上：依赖项延迟加载</li>
</ul>

<p>如需进一步阅读，请访问<a href="https://www.baeldung.com/spring-lazy-annotation">此文章</a></p>

<h4 id="primary">@Primary</h4>
<p>有时我们需要定义多个相同类型的bean。在这些情况下，注入将不会成功，因为Spring不知道我们需要哪种bean</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@Primary</span>
<span class="kd">class</span> <span class="nc">Car</span> <span class="kd">implements</span> <span class="nc">Vehicle</span> <span class="o">{}</span>
 
<span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">Bike</span> <span class="kd">implements</span> <span class="nc">Vehicle</span> <span class="o">{}</span>
 
<span class="nd">@Component</span>  <span class="c1">//spring 注入Car Bean</span>
<span class="kd">class</span> <span class="nc">Driver</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">;</span>
<span class="o">}</span>
 
<span class="nd">@Component</span>  <span class="c1">//spring 注入bike Bean</span>
<span class="kd">class</span> <span class="nc">Biker</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="o">(</span><span class="s">"bike"</span><span class="o">)</span>
    <span class="nc">Vehicle</span> <span class="n">vehicle</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="scope">@Scope</h4>
<p>我们使用<a href="https://www.baeldung.com/spring-bean-scopes"><strong>@Scope</strong></a>来定义@Component类的范围或@Bean定义。它可以是singleton，prototype，request，session，globalSession或某些自定义范围。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@Scope</span><span class="o">(</span><span class="s">"prototype"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">Engine</span> <span class="o">{}</span>
</code></pre></div></div>
<h3 id="context-configuration-annotations">Context Configuration Annotations</h3>
<h4 id="profile">@Profile</h4>
<p>详见<a href="https://www.baeldung.com/spring-profiles">这里</a></p>
<h4 id="import">@Import</h4>
<p>我们可以使用特定的@Configuration类，而不使用组件扫描（component scanning ）。我们可以为这些类提供@ Import的value参数：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Import</span><span class="o">(</span><span class="nc">VehiclePartSupplier</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="importresource">@ImportResource</h4>
<p>我们可以使用此批注导入XML配置。我们可以使用locations参数或其别名value参数指定XML文件位置：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ImportResource</span><span class="o">(</span><span class="s">"classpath:/annotations.xml"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="propertysource">@PropertySource</h4>
<p>指定properties文件
@PropertySource利用Java 8重复注释功能，这意味着我们可以多次使用它标记一个类：</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"classpath:/annotations.properties"</span><span class="o">)</span>
<span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"classpath:/vehicle-factory.properties"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="propertysources">@PropertySources</h4>
<p>指定多个@PropertySource配置：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@PropertySources</span><span class="o">({</span> 
    <span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"classpath:/annotations.properties"</span><span class="o">),</span>
    <span class="nd">@PropertySource</span><span class="o">(</span><span class="s">"classpath:/vehicle-factory.properties"</span><span class="o">)</span>
<span class="o">})</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>

<h2 id="spring-boot-annotations">Spring Boot Annotations</h2>
<h3 id="概述-1">概述</h3>
<p>Spring Boot通过自动配置功能使Spring更容易配置。<br />
在这个文章中，讨论 <strong><code class="language-plaintext highlighter-rouge">org.springframework.boot.autoconfigure</code></strong> 和<strong><code class="language-plaintext highlighter-rouge">org.springframework.boot.autoconfigure.condition </code></strong>包。</p>
<h3 id="springbootapplication">@SpringBootApplication</h3>
<p>这个注解来标记Spring Boot应用程序的主类<br />
 <strong><code class="language-plaintext highlighter-rouge">@SpringBootApplication</code></strong> 默认包括 <strong><code class="language-plaintext highlighter-rouge">@Configuration</code></strong>， <strong><code class="language-plaintext highlighter-rouge">@ EnableAutoConfiguration</code></strong> 和 <strong><code class="language-plaintext highlighter-rouge">@ComponentScan</code></strong> 注释。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryApplication</span> <span class="o">{</span>
 
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">VehicleFactoryApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="enableautoconfiguration">@EnableAutoConfiguration</h3>
<p>顾名思义，支持自动配置。这意味着Spring Boot在其类路径中查找自动配置bean并自动应用它们。</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@EnableAutoConfiguration</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h3 id="自动配置条件-auto-configuration-conditions">自动配置条件 Auto-Configuration Conditions</h3>
<h4 id="conditionalonclass-and-conditionalonmissingclass">@ConditionalOnClass and @ConditionalOnMissingClass</h4>
<p><strong><code class="language-plaintext highlighter-rouge">@ConditionalOnClass</code></strong> 表示对应的类在classpath目录下存在时，才创建标记上该注解的类的实例
<strong><code class="language-plaintext highlighter-rouge">@ConditionalOnMisssingClass</code></strong> 表示classPath不存在指定的Class时，创建标记上该注解的类的实例</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ConditionalOnClass</span><span class="o">(</span><span class="nc">DataSource</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">MySQLAutoconfiguration</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="conditionalonbean-and-conditionalonmissingbean">@ConditionalOnBean and @ConditionalOnMissingBean</h4>
<p>ConditionalOnBean: 表示指定的bean classes and/or bean names在当前容器中,才创建标记上该注解的类的实例
ConditionalOnMissingBean: 表示指定的bean classes and/or bean names不存在当前容器中,才创建标记上该注解的类的实例，有指定忽略ignored的参数存在，可以忽略Class、Type等</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnBean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"dataSource"</span><span class="o">)</span>
<span class="nc">LocalContainerEntityManagerFactoryBean</span> <span class="nf">entityManagerFactory</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="conditionalonresource">@ConditionalOnResource</h4>
<p>仅在存在特定资源时才创建标记上该注解的类的实例</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ConditionalOnResource</span><span class="o">(</span><span class="n">resources</span> <span class="o">=</span> <span class="s">"classpath:mysql.properties"</span><span class="o">)</span>
<span class="nc">Properties</span> <span class="nf">additionalProperties</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="conditionalonwebapplication-and-conditionalonnotwebapplication">@ConditionalOnWebApplication and @ConditionalOnNotWebApplication</h4>
<p>我们可以根据当前应用程序是否是Web应用程序创建</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nd">@ConditionalOnWebApplication</span>
<span class="nc">HealthCheckController</span> <span class="nf">healthCheckController</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="conditionalexpression">@ConditionalExpression</h4>
<p>当SpEL表达式求值为true时才创建</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="nd">@ConditionalOnExpression</span><span class="o">(</span><span class="s">"${usemysql} &amp;&amp; ${mysqlserver == 'local'}"</span><span class="o">)</span>
<span class="nc">DataSource</span> <span class="nf">dataSource</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h4 id="conditional">@Conditional</h4>
<p>对于更复杂的条件，我们可以创建一个评估自定义条件的类。我们告诉Spring使用@Conditional使用这个自定义条件</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Conditional</span><span class="o">(</span><span class="nc">HibernateCondition</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nc">Properties</span> <span class="nf">additionalProperties</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="spring-bean-annotations">Spring Bean Annotations</h2>
<h3 id="概述-2">概述</h3>
<p>在本文中，我们将讨论用于定义不同类型bean的最常见的Spring bean注释。</p>

<p>有几种方法可以在Spring容器中配置bean。我们可以使用XML配置声明它们。我们可以在配置类中使用@Bean批注声明bean。</p>

<p>或者我们可以使用org.springframework.stereotype包中的一个注释标记该类，并将其余部分留给组件扫描。</p>

<h3 id="componentscan-组件扫描-component-scanning-">@ComponentScan 组件扫描（ Component Scanning ）</h3>
<p>如果启用了组件扫描，Spring可以自动扫描bean的包。</p>

<p>@ComponentScan配置要扫描具有注释配置的类的包。我们可以直接使用basePackages或value参数之一指定基本包名（value是basePackages的别名）：</p>

<h4 id="basepackages">basePackages</h4>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.baeldung.annotations"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="basepackageclasses">basePackageClasses</h4>
<p>此外，我们可以使用basePackageClasses参数指向基础包中的类：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="nc">VehicleFactoryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="basepackages-多参数">basePackages 多参数</h4>
<p>参数为字符串数组指定多个包</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@ComponentScan</span><span class="o">({</span><span class="s">"com.my.package.first"</span><span class="o">,</span><span class="s">"com.my.package.second"</span><span class="o">})</span>
</code></pre></div></div>

<h4 id="basepackages-空参数">basePackages 空参数</h4>
<p>不指定参数默认为当前包</p>

<h4 id="指定多次">指定多次</h4>
<p>@ComponentScan利用Java 8重复注释功能，这意味着我们可以多次用它标记一个类</p>
<h5 id="方法一">方法一</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.baeldung.annotations"</span><span class="o">)</span>
<span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="nc">VehicleFactoryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h5 id="方法二">方法二</h5>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="nd">@ComponentScans</span><span class="o">({</span> 
  <span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">"com.baeldung.annotations"</span><span class="o">),</span> 
  <span class="nd">@ComponentScan</span><span class="o">(</span><span class="n">basePackageClasses</span> <span class="o">=</span> <span class="nc">VehicleFactoryConfig</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="o">})</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{}</span>
</code></pre></div></div>
<h4 id="使用xml配置">使用XML配置</h4>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.baeldung"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>
<h3 id="component">@Component</h3>
<p>@Component是类级别注释。在组件扫描期间，Spring Framework会自动检测使用@Component注释的类</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">class</span> <span class="nc">CarUtility</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>默认情况下，此类的bean实例名称为小写首字母的类名。也可以使用 <strong><code class="language-plaintext highlighter-rouge">value</code></strong> 参数指定其他名称。</p>

<p>由于 <strong><code class="language-plaintext highlighter-rouge">@Repository</code></strong> ， <strong><code class="language-plaintext highlighter-rouge">@Service</code></strong> ， <strong><code class="language-plaintext highlighter-rouge">@Configuration</code></strong> 和 <strong><code class="language-plaintext highlighter-rouge">@Controller</code></strong> 都是 <strong><code class="language-plaintext highlighter-rouge">@Component</code></strong> 的元注释，因此它们共享相同的bean命名行为。此外，Spring会在组件扫描过程中自动拾取它们。</p>

<h3 id="repository">@Repository</h3>
<p>DAO或Repository类通常表示应用程序中的数据库访问层，应使用@Repository注释：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Repository</span>
<span class="kd">class</span> <span class="nc">VehicleRepository</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<p>使用此批注的一个优点是它启用了自动持久性异常转换。</p>

<p>当使用诸如Hibernate之类的持久性框架时，在使用 <strong><code class="language-plaintext highlighter-rouge">@Repository</code></strong> 注释的类中抛出的本机异常将自动转换为Spring的 <strong><code class="language-plaintext highlighter-rouge">DataAccessExeption</code></strong> 的子类。</p>

<p>要启用异常转换，我们需要声明自己的<strong><code class="language-plaintext highlighter-rouge">PersistenceExceptionTranslationPostProcessor</code></strong> <strong><code class="language-plaintext highlighter-rouge">bean</code></strong>：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">PersistenceExceptionTranslationPostProcessor</span> <span class="nf">exceptionTranslation</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">PersistenceExceptionTranslationPostProcessor</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>在大多数情况下，Spring会自动执行上述步骤。 或者，通过XML配置：</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.dao.annotation.PersistenceExceptionTranslationPostProcessor"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<h3 id="service">@Service</h3>
<p>应用程序的业务逻辑通常位于服务层内 - 因此我们将使用@Service批注指示类属于该层：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VehicleService</span> <span class="o">{</span>
    <span class="c1">// ...    </span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="controller">@Controller</h3>
<p>@Controller是一个类级别的注释，告诉Spring Framework这个类在Spring MVC中充当控制器</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VehicleController</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</code></pre></div></div>
<h3 id="configuration">@Configuration</h3>
<p>配置类可以包含使用@Bean注释的bean定义方法：</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">class</span> <span class="nc">VehicleFactoryConfig</span> <span class="o">{</span>
 
    <span class="nd">@Bean</span>
    <span class="nc">Engine</span> <span class="nf">engine</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Engine</span><span class="o">();</span>
    <span class="o">}</span>
 
<span class="o">}</span>
</code></pre></div></div>
<h3 id="stereotype-annotations-and-aop">Stereotype Annotations and AOP</h3>
<p>当我们使用Spring构造型注释时，很容易创建一个针对具有特定构造型的所有类的切入点。</p>

<p>例如，假设我们想要从DAO层测量方法的执行时间。我们将利用@Repository构造型创建以下方面（使用AspectJ注释）</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Aspect</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PerformanceAspect</span> <span class="o">{</span>
    <span class="nd">@Pointcut</span><span class="o">(</span><span class="s">"within(@org.springframework.stereotype.Repository *)"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">repositoryClassMethods</span><span class="o">()</span> <span class="o">{};</span>
 
    <span class="nd">@Around</span><span class="o">(</span><span class="s">"repositoryClassMethods()"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">measureMethodExecutionTime</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="o">)</span> 
      <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
        <span class="nc">Object</span> <span class="n">returnValue</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">proceed</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">nanoTime</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
          <span class="s">"Execution of "</span> <span class="o">+</span> <span class="n">methodName</span> <span class="o">+</span> <span class="s">" took "</span> <span class="o">+</span> 
          <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">NANOSECONDS</span><span class="o">.</span><span class="na">toMillis</span><span class="o">(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">)</span> <span class="o">+</span> <span class="s">" ms"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">returnValue</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>在这个例子中，我们创建了一个切入点，它匹配用@Repository注释的类中的所有方法。我们使用 @Around环绕通知 然后定位该切入点并确定截获的方法调用的执行时间。</p>

<p>使用此方法，我们可以向每个应用程序层添加日志记录，性能管理，审计或其他行为。</p>

  </div>

  <div class='post-footer'>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class='post-previous' href="/tech/2018/07/23/Ubuntu-server-%E5%AE%89%E8%A3%85%E5%90%8E%E7%BB%AD.html"> &nbsp;←  Ubuntu Server 安装后续</a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <a class='post-next' href="/tech/2018/10/10/Linux%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE.html">Linux软件环境安装配置 →&nbsp;</a>
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
  </div>

</article>

<div id='utterances' class="utterances-comments-header">
  <div>
    <div>Comments </div>
    <strong>[ If it doesn't show up, please wait a moment... ]</strong>&nbsp;
  </div>
  <a target="_blank" href="https://github.com/uhfun/Uhfun-Jekyll/issues?q=/tech/2018/08/08/Spring%E6%B3%A8%E8%A7%A3.html">Issue Page</a>
</div>
<script src="https://utteranc.es/client.js"
        repo= "uhfun/Uhfun-Jekyll"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>


  </div>
</article>

    </div>
  </div>
  <footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        Copyright © Uhfun Blog 2019<br>
        Powered by <strong> <a target="_blank" href="https://github.com/jekyll/jekyll">Jekyll</a></strong>
        &nbsp;|&nbsp;Themed by <strong> <a target="_blank" href="https://github.com/uhfun/Uhfun-Jekyll">Uhfun-Jekyll</a></strong> 
        &nbsp; <br> licensed <a target="_blank" href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a></a>.
        &nbsp;
      </p>
    </div>
  </div>
</footer>
<div class="back-to-top is-info">
    <a class="icon-stack">
        <ion-icon name="arrow-dropup">
            <svg class="svg-icon">
                <use xlink:href="/assets/arrow-dropup.svg"></use>
            </svg>
        </ion-icon>
        <span class="back-to-top-text">Top</span>
    </a>
</div>
<script src="/assets/js/back-to-top.js"></script>
<script src="/assets/js/hash-code.js"></script>
<script src="/assets/js/drop-down.js"></script>
<script src="/assets/js/category-post-num.js"></script>
<script src="/assets/js/baidu-push.js"></script>
<script src="/assets/js/toc.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
      $('#toc').toc();
  }); </script>
<script>
    $('.brief-content .content .title-content').each((i, e) => {
        $bt = $(e);
        const hashCode = $bt.text().hashCode();
        const list = [
        
        '#f16181',
        
        '#fd7676',
        
        '#53aee4',
        ];       
        const n = hashCode % list.length;
        const color =  list[(n < 0 ? n + list.length : n)];
        console.log(color)
        $bt.css('color', color);
        $bt.children('.brief-quote').css('color', color);
    })
</script>
</body>
<script src="/assets/js/date-format.js"></script>
</html>